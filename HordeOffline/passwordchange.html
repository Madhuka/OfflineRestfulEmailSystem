
<!--
This is to change the passwords in a LDAP server which uses md5crypt password encryption
This script makes an anonymous bind and find the dn first then anuthenticate the existing password.
Thereafter let users to change the password if the old password is correct.
 
Written by Sarves, iamsarves@gmail.com
 
28.12.2010
--> 
 
<!DOCTYPE HTML>
<!--   IMP: Copyright 2001-2008 The Horde Project.  IMP is under the GPL.  -->
<!-- Hore Project: http://www.horde.org/ | IMP: http://www.horde.org/imp/ -->
<!--        GNU Public License: http://www.fsf.org/copyleft/gpl.html       -->
<html manifest="mani/hordefront.manifest">
<head>
<style type="text/css">
.notices{
	font-weight: bold;
	color: black;
	background: #FFC;
	border: 1px solid #AAA;
	padding: 1px 1px 1px 5px;
	list-style-type: none;
	margin-left:10px;
	margin-right:10px;
}
</style>
<script type="text/javascript" src="js/prototype.js"></script> 
<script type="text/javascript">

function submitChangePwd(){
	var uid=$('userid').value;
	var opwd=$('old_pwd').value;
	var npwd=$('new_pwd').value;
	var npwd2=$('new_pwd_2').value;
	$('pwderrorinfo').style.display="none";
	
	if(uid==''||opwd==''||npwd==''||npwd2=='')
	{
		$('pwderrorinfo').style.display="block";
		$('pwderrorinfo').update('Please fill all fields.');
		
	}
	else if(npwd.length<8)
	{
		$('pwderrorinfo').update('Minimum length of your new password is 8.');
		$('pwderrorinfo').style.display="block";
	}
	else if(npwd==npwd2)
	{
		$('pwderrorinfo').update('New password does not match with its copy. Please check again.');
		$('pwderrorinfo').style.display="block";
	}
	else{
		//need work
		alert('need a function to change password')
		if(true){//function will come here
			$('failmsg').style.display='none';
			$('successmsg').style.display='block';
		}else{
			$('successmsg').style.display='none';
			$('failmsg').style.display='block';
		}
	}
	
	
	
	//$('userid').value="";
	$('old_pwd').value="";
	$('new_pwd').value="";
	$('new_pwd_2').value="";
}


</script>
</head>
<body> 
 
<table bgcolor="#9999CC" width="100%"> 
<tr> <td align="center"> <font color="#FFFFFF"> <h2> Password change interface</h2> </font> </td> </tr> 
<!--<tr> <td align="center"> <font color="#FFFFFF"> <h3> Mail Management Interface</h3> </font> </td> </tr>--> 
</table> 
<br /> <br /> 
<ul id="successmsg" style="display:none" class="notices"><li><img src="img/theme/graphics/alerts/success.png" alt="Success" title="">You password has been successfully updated.</li></ul>
<ul id="failmsg" style="display:none" class="notices"><li><img src="img/theme/graphics/alerts/error.png" alt="Success" title="">Failed to update your password. </li></ul>

<br/>
<table align="center"> 
<FORM ACTION="#"> 
<tr> <td> Username</td> <td> <INPUT TYPE="TEXT" NAME="userid" id="userid" > </td> </tr> 
<tr> <td> Old Password</td> <td><INPUT TYPE="PASSWORD" NAME="old_pwd" id="old_pwd" > </td> </tr> 
<tr> <td> New Password</td> <td><INPUT TYPE="PASSWORD" NAME="new_pwd" id="new_pwd" > </td> </tr> 
<tr> <td> Confirm new Password</td> <td><INPUT TYPE="PASSWORD" NAME="new_pwd_2" id="new_pwd_2" > </td> </tr> 
<tr> <td> </td> <td align="right"><INPUT TYPE="button" NAME="submitted" VALUE="Change Password" onClick="submitChangePwd()"> </td> </tr> 
</FORM> 
</table> 
<br/>
<table align="center" >
<tbody><tr colspan="2"> <td align="center"> <font color="red"><p id="pwderrorinfo" style="display:none"> Your new password length is less than 8! </p>
</font></td> 
</tr></tbody></table>
<br/>
<table align=center bgcolor="#FFCCCC"> 
<tr> <td colspan="2" align=left> <strong>  Password Policy : </strong> <br /> The minimum length of your new password must be 8. </td> </tr> 
</table> 
<!-- 
<p align=center> <a href="https://webmail.uom.lk"> Back to Webmail </a> </p>
 
--> 
</body> 
</html> 